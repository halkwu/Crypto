# Multi-Chain Toolkit (Blockstream / EthVM / Solana)

This repository contains several subprojects for demonstrating and testing multi-chain features: Bitcoin (blockstream), EVM-like chains (ethvm), Solana (solana), an Angular frontend (angular-ui), and a simple API aggregator example (api).

**Directory structure**
- `blockstream/` — BTC-related tools and API (generate wallets, query balances, send transactions)
- `ethvm/` — EVM-like examples (generate wallets, query, send)
- `solana/` — Solana examples (generate keypairs, query, send)
- `schema.graphql` — Merged root GraphQL schema (generated by combining the schemas from `blockstream`, `ethvm`, and `solana`)

**Prerequisites**

- Node.js (14+ recommended)
- npm
- `ts-node` either installed globally or available via `npx` (development dependencies include it; you can run TypeScript scripts with `npx ts-node` if not installed globally)

**Quick start (from repository root)**

1. Install dependencies for each subproject (example: run in each subdirectory):

```bash
cd ../blockstream && npm install
cd ../ethvm && npm install
cd ../solana && npm install
```

2. Start or run each subproject:
- Blockstream (example)

```bash
cd blockstream
npx ts-node blockstream_api.ts 
```

- EthVM (generate example wallets / scripts)

```bash
cd ethvm
[Environment]::SetEnvironmentVariable('ALCHEMY_SEPOLIA_RPC','https://eth-sepolia.alchemyapi.io/v2/YOUR_KEY','User')
[Environment]::SetEnvironmentVariable('ETHERSCAN_API_KEY','YOUR_ETHERSCAN_KEY','User')

npx ts-node ethvm_api.ts 
```

- Solana

The Solana subdirectory contains TypeScript script examples; run specific scripts with `ts-node` (for example `solana.ts` if present).

```bash
cd solana
npx ts-node solana_api.ts 
```

**Common examples (PowerShell / curl)**

Each submodule exposes REST endpoints in the example API:

- Query balance / txs (PowerShell example):

Blockstream port:3000
EthVM port:3001
solana port: 3002
```powershell
Invoke-RestMethod "http://localhost:port/balance?address=YourAddress" | ConvertTo-Json
Invoke-RestMethod "http://localhost:port/txs?address=YourAddress" | ConvertTo-Json
```

- Generate wallets (POST):

```powershell
Invoke-RestMethod -Uri 'http://localhost:port/generate' -Method POST -Body (ConvertTo-Json @{count=2; label='demo-wallets'; save=$true; outputPath='demo_wallets.json'}) -ContentType 'application/json'
```

- Send transaction (EVM example):

```powershell
Invoke-RestMethod -Uri 'http://localhost:port/send' -Method POST -Body (ConvertTo-Json @{ fromPrivateKey='0xYOUR_PRIVATE_KEY'; to='0xRECIPIENT'; amount='0.001' }) -ContentType 'application/json'
```


**GraphQL**

A merged `schema.graphql` is provided at the repository root. It combines the three schemas (`blockstream`, `ethvm`, and `solana`) into a single schema file: [schema.graphql](schema.graphql).

Below are notes and a small example for running a module-level GraphQL server (Solana) that uses the merged schema and proxies queries to the example REST backend.

- **Example implementation**: The Solana example GraphQL server is implemented in `solana/solana_graphql.ts`. That script loads the top-level `schema.graphql`, defines `Date` and `JSON` custom scalars, and implements resolvers that proxy `balance` and `txs` queries to the REST API (default REST base: `http://localhost:3002`).

- **Install dependencies**:

```bash
cd solana
npm install
```

- **Run the example GraphQL server (Solana)**:

```bash
cd solana
npx ts-node solana_graphql.ts
```

The server starts an Apollo/Express GraphQL endpoint on port `4002` by default (override with the `PORT` environment variable). The server logs the GraphQL URL and the `REST_BASE` it is proxying to.

- **Configuration**:
	- `REST_BASE` — REST backend base URL that resolvers proxy to (default: `http://localhost:3002`).
	- `PORT` — GraphQL server port (default: `4002`).
	See `solana/package.json` for runtime dependencies such as `apollo-server-express` and `graphql`.

- **Sample GraphQL query**:

```graphql solana
query GetBalanceAndTxs($address: String!, $limit: Int) {
  balance(address: $address) {
    address
    network
    balance
    currency
  }
  txs(address: $address, limit: $limit) {
    address
    network
    transaction {
      Signature
      time
      from
      to
      amount
      fee
      currency
      status
      balance
    }
  }
}
```

```query variables
{
	"address": "126mzPE5MSj6dQzqYieUZD1vyUbe7gkGoDKEhB26Zahs",
	"limit": 1000
}
```

The `balance` and `txs` resolvers in `solana/solana_graphql.ts` forward requests to the REST endpoints (for example `/balance?address=...`), handle upstream errors, and return structured GraphQL responses.It can also be applied to blockstream and ethvm.

```graphql ethvm
query GetBalanceAndTxs($address: String!, $limit: Int) {
  balance(address: $address) {
    address
    network
    balance
    currency
  }
  txs(address: $address, limit: $limit) {
    address
    network
    transaction {
      Signature
      time
      from
      to
      amount
      fee
      currency
      status
      balance
    }
  }
}
```

```query variables
{
	"address": "0x24C05221757D8A02688ca054570EE9AaBc9F1733",
	"limit": 1000
}
```

```graphql blockstream
query GetBalanceAndTxs($address: String!, $limit: Int) {
  balance(address: $address) {
    address
    network
    balance
    currency
  }
  txs(address: $address, limit: $limit) {
    address
    network
    transaction {
      Signature
      time
      from
      to
      amount
      fee
      currency
      status
      balance
    }
  }
}
```

```query variables
{
	"address": "tb1qy63lsd8ld6wj258gp0aazvsy27um52e53hyzth",
	"limit": 1000
}
```

If you want a unified GraphQL server for all modules, mount each module's resolvers on a single ApolloServer instance while using the merged `schema.graphql` as the type definitions.

